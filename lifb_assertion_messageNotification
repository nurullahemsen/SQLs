create or replace function messagenotificationcondition() returns trigger as $$
begin
    IF NOT EXISTS (SELECT * FROM message,notification WHERE 
				   notification.creator_id = new.receiver_id 
				   AND notification.notification_content = 'new message!' 
				   AND notification.is_seen = false  ) THEN
		INSERT INTO public.notification(
		ndate, is_seen, creator_id,notification_content)
		VALUES (new.mdate,false,new.receiver_id,'new message!');
	ELSE
	RAISE NOTICE 'Yeni bildirim oluşturulmadı, okunmamış mesaj bildirimi zaten mevcut.';
	END IF;
	RETURN NEW;
end;
$$ language plpgsql;

--CREATE TRIGGER messagenotification
--  BEFORE INSERT ON message
  --FOR EACH ROW
  --EXECUTE PROCEDURE messagenotificationcondition()
  
  